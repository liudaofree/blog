# JVM内存结构

##### 一、内存结构

![img](https://vipkshttps6.wiz.cn/editor/389f1850-89b1-11ec-ba6c-21d96952d446/7460e301-f90f-4223-b1dc-e8f860807366/resources/atCiDyXCbSajXVlIAmiKb_gYRHqD3uOAEdgJhVOQVy8.svg?token=W.J5MNwiJr1llSIlMUDOpmu2NwjSqJ42LBIk46s5AkbVAKxcyEinad8SF2nm9ZYiM)

#####  

##### 二、程序计数器

- 概念

- 程序计数寄存器**(Program Counter Register)**，程序计数器是一块较小的内存空间，可以看做当前线程所执行字节码的行号指示器

- pc寄存器用来存储指向下一条指令的地址，即将要执行的指令代码。由执行引擎读取下一条指令。

- 特性

- 程序计数器是线程私有的

- 它是唯一一个在JVM规范中，没有规定任何 **OutOfMemoryError** 情况的区域

- 作用

- 因为cpu会不停的切换线程，在线程被切换回来的时候，需要知道当前执行代码位置，JVM的字节码解释器就需要通过改变PC寄存器的值来明确下一条应该执行什么样的字节码指令。

##### 三、虚拟机栈

- 每个线程在创建的时候都会创建一个虚拟机栈，其内部保存一个个的栈帧，对应着一次次java方法调用，是线程私有的，生命周期和线程保持一致。

- 栈帧的内部结果

- 局部变量表

- 操作数栈 表达式栈

- 动态链接 指向运行时常量池的方法引用

- 方法返回地址 方法正常推出或异常退出的地址

- 一些附加信息

##### 四、本地方法栈

- Java 虚拟机栈用于管理 Java 方法的调用，而本地方法栈用于管理本地方法的调用

- 本地方法栈也是线程私有的

##### 五、堆内存

- 对于大多数应用，Java 堆是 Java 虚拟机管理的内存中最大的一块，被所有线程共享。此内存区域的唯一目的就是存放对象实例，几乎所有的对象实例以及数据都在这里分配内存。

- 为了进行高效的垃圾回收，虚拟机把堆内存**逻辑上**划分成三块区域（分代的唯一理由就是优化 GC 性能）：

- 新生带（年轻代）：新对象和没达到一定年龄的对象都在新生代

- 老年代（养老区）：被长时间使用的对象，老年代的内存空间应该要比年轻代更大

- 元空间（JDK1.8 之前叫永久代）：像一些方法中的操作临时对象等，JDK1.8 之前是占用 JVM 内存，JDK1.8 之后直接使用物理内存

##### 六、方法区

- 方法区（Method Area）与 Java 堆一样，是所有线程共享的内存区域。

- 虽然 Java 虚拟机规范把方法区描述为堆的一个逻辑部分，但是它却有一个别名叫 Non-Heap（非堆），目的应该是与 Java 堆区分开。

- 运行时常量池（Runtime Constant Pool）是方法区的一部分。Class 文件中除了有类的版本/字段/方法/接口等描述信息外，还有一项信息是常量池（Constant Pool Table），用于存放编译期生成的各种字面量和符号引用，这部分内容将类在加载后进入方法区的运行时常量池中存放。运行期间也可能将新的常量放入池中，这种特性被开发人员利用得比较多的是 String.intern()方法。受方法区内存的限制，当常量池无法再申请到内存时会抛出 OutOfMemoryError 异常。

##### 